// Generated by CoffeeScript 1.7.1
var Form, FormView, exports;

exports = this;

Form = (function() {
  function Form() {
    this.data = new Object;
    this.form = {
      message: $('#message'),
      csrfToken: $('#csrfToken')
    };
  }

  Form.prototype.validate = function() {
    this.data.message = this.form.message.val().replace(/^\s+|\s+$/g, '');
    this.data.csrfToken = this.form.csrfToken.val();
    return this.data.message.length > 0;
  };

  return Form;

})();

FormView = (function() {
  function FormView() {
    this.form = {
      message: $('#message-group'),
      submitBtn: $('#submitBtn')
    };
    this.help = {
      message: $('#message-help'),
      result: $('#result-text')
    };
  }

  FormView.prototype.error = function() {
    this.form.message.addClass('has-error');
    return this.help.message.text('本文を入力してください');
  };

  FormView.prototype.sending = function() {
    this.reset();
    return this.form.submitBtn.button('sending');
  };

  FormView.prototype.sendComplete = function() {
    this.form.submitBtn.button('reset');
    this.form.submitBtn.attr('disabled', true);
    return this.help.result.text('お問い合わせありがとうございました。');
  };

  FormView.prototype.sendError = function() {
    this.form.submitBtn.button('reset');
    return this.help.result.text('送信できませんでした。時間をおして再送信してください。');
  };

  FormView.prototype.reset = function() {
    this.form.message.removeClass('has-error');
    this.form.submitBtn.button('reset');
    this.help.result.text('');
    return this.help.message.text('');
  };

  return FormView;

})();

$(function() {
  var form, view;
  form = new Form;
  view = new FormView;
  return $('#submitBtn').click(function() {
    var data;
    view.reset();
    if (form.validate() !== true) {
      view.error();
      return false;
    }
    view.sending();
    data = form.data;
    return $.ajax({
      url: 'contact_form.php',
      data: data,
      type: 'post',
      success: function() {
        return view.sendComplete();
      },
      error: function() {
        return view.sendError();
      }
    });
  });
});
